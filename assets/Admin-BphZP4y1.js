import{w as oe,a as d,p as e}from"./chunk-UH6JLGW7-C5_N2qaM.js";import{d as Ae,u as ue,g as pe,h as he,i as je}from"./apiSlise-DkzWnf8z.js";const be="_Admin_1nv1j_1",ge="_Admin__page_1nv1j_4",ve="_Admin__container_1nv1j_9",xe="_Admin__loginPanel_1nv1j_14",Ne="_Admin__loginCard_1nv1j_20",fe="_Admin__eyebrow_1nv1j_27",ye="_Admin__loginTitle_1nv1j_34",ke="_Admin__loginDescription_1nv1j_39",we="_Admin__loginForm_1nv1j_44",Se="_Admin__label_1nv1j_49",Ge="_Admin__input_1nv1j_54",Ie="_Admin__submitButton_1nv1j_68",Ce="_Admin__workspace_1nv1j_83",Be="_Admin__header_1nv1j_90",Te="_Admin__title_1nv1j_96",Fe="_Admin__subtitle_1nv1j_101",Ue="_Admin__metaGroup_1nv1j_106",Le="_Admin__metaLabel_1nv1j_110",Ee="_Admin__metaValue_1nv1j_117",De="_Admin__statsGrid_1nv1j_122",Pe="_Admin__statBlock_1nv1j_128",$e="_Admin__statLabel_1nv1j_134",He="_Admin__statValue_1nv1j_139",Re="_Admin__statHint_1nv1j_144",Oe="_Admin__tabBar_1nv1j_149",Qe="_Admin__tab_1nv1j_149",Ve="_Admin__workspaceBody_1nv1j_169",Me="_Admin__sidebar_1nv1j_177",qe="_Admin__sidebarTitle_1nv1j_187",Je="_Admin__sidebarBlock_1nv1j_194",Xe="_Admin__sidebarLabel_1nv1j_203",ze="_Admin__sidebarTextarea_1nv1j_210",Ke="_Admin__sidebarImageInput_1nv1j_221",We="_Admin__sidebarImagePreview_1nv1j_228",Ye="_Admin__sidebarImage_1nv1j_221",Ze="_Admin__secondaryButton_1nv1j_240",en="_Admin__sidebarDivider_1nv1j_254",nn="_Admin__metaBlock_1nv1j_258",sn="_Admin__panel_1nv1j_263",an="_Admin__panelGrid_1nv1j_270",tn="_Admin__sectionTitle_1nv1j_276",_n="_Admin__listColumn_1nv1j_281",dn="_Admin__listHint_1nv1j_292",ln="_Admin__listItem_1nv1j_297",mn="_Admin__listThumb_1nv1j_313",cn="_Admin__listMeta_1nv1j_320",rn="_Admin__listTitle_1nv1j_325",on="_Admin__listSubline_1nv1j_329",An="_Admin__listBadge_1nv1j_333",un="_Admin__detailPanel_1nv1j_342",pn="_Admin__uploadRow_1nv1j_352",hn="_Admin__fileInput_1nv1j_357",jn="_Admin__uploadFeedback_1nv1j_365",bn="_Admin__formGrid_1nv1j_379",gn="_Admin__fieldGroup_1nv1j_384",vn="_Admin__textarea_1nv1j_389",xn="_Admin__switchRow_1nv1j_397",Nn="_Admin__actions_1nv1j_404",fn="_Admin__status_1nv1j_409",n={Admin:be,Admin__page:ge,Admin__container:ve,Admin__loginPanel:xe,Admin__loginCard:Ne,Admin__eyebrow:fe,Admin__loginTitle:ye,Admin__loginDescription:ke,Admin__loginForm:we,Admin__label:Se,Admin__input:Ge,Admin__submitButton:Ie,Admin__workspace:Ce,Admin__header:Be,Admin__title:Te,Admin__subtitle:Fe,Admin__metaGroup:Ue,Admin__metaLabel:Le,Admin__metaValue:Ee,Admin__statsGrid:De,Admin__statBlock:Pe,Admin__statLabel:$e,Admin__statValue:He,Admin__statHint:Re,Admin__tabBar:Oe,Admin__tab:Qe,"Admin__tab--active":"_Admin__tab--active_1nv1j_164",Admin__workspaceBody:Ve,Admin__sidebar:Me,Admin__sidebarTitle:qe,Admin__sidebarBlock:Je,Admin__sidebarLabel:Xe,Admin__sidebarTextarea:ze,Admin__sidebarImageInput:Ke,Admin__sidebarImagePreview:We,Admin__sidebarImage:Ye,Admin__secondaryButton:Ze,Admin__sidebarDivider:en,Admin__metaBlock:nn,Admin__panel:sn,Admin__panelGrid:an,Admin__sectionTitle:tn,Admin__listColumn:_n,Admin__listHint:dn,Admin__listItem:ln,"Admin__listItem--active":"_Admin__listItem--active_1nv1j_309",Admin__listThumb:mn,Admin__listMeta:cn,Admin__listTitle:rn,Admin__listSubline:on,Admin__listBadge:An,Admin__detailPanel:un,Admin__uploadRow:pn,Admin__fileInput:hn,Admin__uploadFeedback:jn,"Admin__uploadFeedback--success":"_Admin__uploadFeedback--success_1nv1j_370","Admin__uploadFeedback--error":"_Admin__uploadFeedback--error_1nv1j_373","Admin__uploadFeedback--uploading":"_Admin__uploadFeedback--uploading_1nv1j_376",Admin__formGrid:bn,Admin__fieldGroup:gn,Admin__textarea:vn,Admin__switchRow:xn,Admin__actions:Nn,Admin__status:fn,"Admin__status--error":"_Admin__status--error_1nv1j_414"},L={name:"",href:"#",category:"",country:"",price:"",discount:"",imgUrl:"",rate:"",commentsSum:"",description:"",isHit:!1},E={title:"",imgUrl:"",link:"#"},Gn=oe(function(){var q,J,X,z,K;const[G,D]=d.useState(""),[y,W]=d.useState(""),[b,Y]=d.useState(!1),[P,g]=d.useState(""),[I,Z]=d.useState("goods"),[m,v]=d.useState(null),[r,k]=d.useState(null),[c,l]=d.useState(L),[w,A]=d.useState(E),[C,o]=d.useState(null),[$,B]=d.useState({section:null,state:"idle",message:""}),[ee,H]=d.useState(""),[x,T]=d.useState(null),u=((q=Ae(null).data)==null?void 0:q.serverUrl)??"",N=ue(null,{skip:!b}),f=pe(null,{skip:!b}),S=he(null,{skip:!b}),p=je(null,{skip:!b}),h=N.data??[],j=f.data??[];d.useEffect(()=>{if(m!=null&&h.length){const i=h.find(s=>s.id===m);if(i){l({name:i.name,href:i.href,category:i.category,country:i.country,price:i.price.toString(),discount:i.discount!=null?i.discount.toString():"",imgUrl:i.imgUrl,rate:i.rate.toString(),commentsSum:i.commentsSum.toString(),description:i.description??"",isHit:!!i.isHit});return}}l(L),m!=null&&v(null)},[m,h]),d.useEffect(()=>{if(r!=null&&j.length){const i=j.find(s=>s.id===r);if(i){A({title:i.title,imgUrl:i.imgUrl,link:i.link});return}}A(E),r!=null&&k(null)},[r,j]),d.useEffect(()=>{var i,s;(i=p.data)!=null&&i.text&&H(p.data.text),(s=p.data)!=null&&s.imgUrl&&!x&&T(p.data.imgUrl)},[p.data,x]);const ne=d.useMemo(()=>{var i;return[{label:"Товары",value:N.isLoading?"...":h.length,hint:"Записей в каталоге"},{label:"Бренды",value:S.isLoading?"...":((i=S.data)==null?void 0:i.length)??0,hint:"Партнёров на витрине"},{label:"Статьи",value:f.isLoading?"...":j.length,hint:"Публикаций в блоге"}]},[h.length,N.isLoading,(J=S.data)==null?void 0:J.length,S.isLoading,j.length,f.isLoading]),R=async(i,s,t)=>{if(!u)throw new Error("Не удалось определить адрес API.");if(!y)throw new Error("Сначала подтвердите код администратора.");const a=await fetch(`${u}/api${i}`,{method:s,headers:{"Content-Type":"application/json","X-ADMIN-CODE":y},body:JSON.stringify(t)}),_=await a.json().catch(()=>({}));if(!a.ok)throw new Error((_==null?void 0:_.message)||"Ошибка сервера");return _},ie=async i=>{if(!u)throw new Error("Не удалось определить адрес API.");if(!y)throw new Error("Сначала подтвердите код администратора.");const s=new FormData;s.append("image",i);const t=await fetch(`${u}/api/admin/upload`,{method:"POST",headers:{"X-ADMIN-CODE":y},body:s}),a=await t.json().catch(()=>({}));if(!t.ok)throw new Error((a==null?void 0:a.message)||"Не удалось загрузить изображение.");return a},O=async(i,s)=>{if(i){B({section:s,state:"uploading",message:"Загрузка изображения..."});try{const t=await ie(i),a=(t==null?void 0:t.path)??(t==null?void 0:t.url)??"";if(!a)throw new Error("Адрес изображения не получен.");s==="goods"?l(_=>({..._,imgUrl:a})):A(_=>({..._,imgUrl:a})),s==="goods"&&!x&&T(a),B({section:s,state:"success",message:"Изображение успешно загружено."})}catch(t){B({section:s,state:"error",message:t instanceof Error?t.message:"Не удалось загрузить файл."})}}},Q=i=>$.section===i?$:null,F=Q("goods"),U=Q("articles"),se=async i=>{if(i.preventDefault(),g(""),!u){g("Сервер ещё не ответил, обновите страницу.");return}try{const s=await fetch(`${u}/api/admin/check-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:G.trim()})}),t=await s.json().catch(()=>({}));if(s.ok&&t.valid){W(G.trim()),Y(!0),D(""),g(""),o({type:"success",message:"Доступ подтверждён. Вы в админке."});return}g(t.message||"Неверный секретный код.")}catch(s){console.error(s),g("Не удалось проверить код. Попробуйте ещё раз.")}},ae=async i=>{i.preventDefault(),o(null);const s=m?"PUT":"POST",t=m?`/admin/goods/${m}`:"/admin/goods";try{const a=await R(t,s,c),_=m?"Товар обновлён":`Товар добавлен (ID ${(a==null?void 0:a.id)??"?"})`;o({type:"success",message:_}),N.refetch(),!m&&(a!=null&&a.id)&&v(Number(a.id))}catch(a){const _=a instanceof Error?a.message:"Не удалось сохранить товар.";o({type:"error",message:_})}},te=async i=>{i.preventDefault(),o(null);const s=r?"PUT":"POST",t=r?`/admin/articles/${r}`:"/admin/articles";try{await R(t,s,w),o({type:"success",message:r?"Статья обновлена":"Статья опубликована"}),f.refetch()}catch(a){const _=a instanceof Error?a.message:"Не удалось сохранить статью.";o({type:"error",message:_})}},_e=i=>{if(m===i){v(null);return}v(i)},de=i=>{if(r===i){k(null);return}k(i)},V=()=>{v(null),l(L)},M=()=>{k(null),A(E)},le=i=>{H(i.target.value)},me=i=>{var a;const s=(a=i.target.files)==null?void 0:a[0];if(!s)return;const t=new FileReader;t.onloadend=()=>{const _=t.result;typeof _=="string"&&T(_)},t.readAsDataURL(s)},ce=()=>N.isLoading?e.jsx("p",{className:n.Admin__listHint,children:"Загружаем товары..."}):h.map(i=>e.jsxs("button",{type:"button",className:`${n.Admin__listItem} ${m===i.id?n["Admin__listItem--active"]:""}`,onClick:()=>_e(i.id),children:[e.jsx("img",{src:i.imgUrl,alt:i.name,className:n.Admin__listThumb}),e.jsxs("div",{className:n.Admin__listMeta,children:[e.jsx("div",{className:n.Admin__listTitle,children:i.name}),e.jsxs("div",{className:n.Admin__listSubline,children:["#",i.id," • ",i.category," • ",i.country]})]}),e.jsxs("div",{className:n.Admin__listBadge,children:[e.jsxs("span",{children:[i.price.toLocaleString()," ₽"]}),i.discount&&i.discount<i.price?e.jsxs("small",{children:["акция ",i.discount.toLocaleString()," ₽"]}):null]})]},i.id)),re=()=>f.isLoading?e.jsx("p",{className:n.Admin__listHint,children:"Загружаем статьи..."}):j.map(i=>e.jsxs("button",{type:"button",className:`${n.Admin__listItem} ${r===i.id?n["Admin__listItem--active"]:""}`,onClick:()=>de(i.id),children:[e.jsxs("div",{className:n.Admin__listMeta,children:[e.jsx("div",{className:n.Admin__listTitle,children:i.title}),e.jsxs("div",{className:n.Admin__listSubline,children:["#",i.id]})]}),e.jsx("div",{className:n.Admin__listBadge,children:e.jsx("span",{children:i.link||"—"})})]},i.id));return e.jsx("main",{className:n.Admin__page,children:e.jsx("div",{className:n.Admin__container,children:b?e.jsxs("section",{className:n.Admin__workspace,children:[e.jsxs("header",{className:n.Admin__header,children:[e.jsxs("div",{children:[e.jsx("p",{className:n.Admin__eyebrow,children:"Суперпанель"}),e.jsx("h1",{className:n.Admin__title,children:"Управление контентом"}),e.jsx("p",{className:n.Admin__subtitle,children:((X=p.data)==null?void 0:X.title)||"SEO-заголовок пока не загружен"})]}),e.jsxs("div",{className:n.Admin__metaGroup,children:[e.jsxs("div",{children:[e.jsx("p",{className:n.Admin__metaLabel,children:"API"}),e.jsx("p",{className:n.Admin__metaValue,children:u||"..."})]}),e.jsxs("div",{children:[e.jsx("p",{className:n.Admin__metaLabel,children:"Статус доступа"}),e.jsx("p",{className:n.Admin__metaValue,children:"Разрешён"})]})]})]}),e.jsx("div",{className:n.Admin__statsGrid,children:ne.map(i=>e.jsxs("article",{className:n.Admin__statBlock,children:[e.jsx("p",{className:n.Admin__statLabel,children:i.label}),e.jsx("p",{className:n.Admin__statValue,children:i.value}),e.jsx("p",{className:n.Admin__statHint,children:i.hint})]},i.label))}),e.jsx("div",{className:n.Admin__tabBar,children:[{key:"goods",label:"Каталог товаров"},{key:"articles",label:"Блог и статьи"}].map(i=>e.jsx("button",{type:"button",className:`${n.Admin__tab} ${I===i.key?n["Admin__tab--active"]:""}`,onClick:()=>{Z(i.key),o(null)},children:i.label},i.key))}),e.jsx("div",{className:n.Admin__workspaceBody,children:e.jsxs("div",{className:n.Admin__panel,children:[C?e.jsx("div",{className:`${n.Admin__status} ${C.type==="error"?n["Admin__status--error"]:n["Admin__status--success"]}`,children:C.message}):null,I==="goods"?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:n.Admin__sectionTitle,children:"Каталог товаров"}),e.jsxs("div",{className:n.Admin__panelGrid,children:[e.jsx("div",{className:n.Admin__listColumn,children:ce()}),e.jsxs("form",{className:n.Admin__detailPanel,onSubmit:ae,children:[e.jsxs("div",{className:n.Admin__formGrid,children:[e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Название"}),e.jsx("input",{className:n.Admin__input,value:c.name,onChange:i=>l(s=>({...s,name:i.target.value})),placeholder:"Название товара",required:!0})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Категория"}),e.jsx("input",{className:n.Admin__input,value:c.category,onChange:i=>l(s=>({...s,category:i.target.value})),placeholder:"Наименование категории"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Страна"}),e.jsx("input",{className:n.Admin__input,value:c.country,onChange:i=>l(s=>({...s,country:i.target.value})),placeholder:"Производитель / страна"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Ссылка"}),e.jsx("input",{className:n.Admin__input,value:c.href,onChange:i=>l(s=>({...s,href:i.target.value})),placeholder:"#"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Цена (₽)"}),e.jsx("input",{type:"number",className:n.Admin__input,value:c.price,onChange:i=>l(s=>({...s,price:i.target.value})),min:"0",step:"10"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Скидка (₽)"}),e.jsx("input",{type:"number",className:n.Admin__input,value:c.discount,onChange:i=>l(s=>({...s,discount:i.target.value})),min:"0",step:"10"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Рейтинг"}),e.jsx("input",{type:"number",className:n.Admin__input,value:c.rate,onChange:i=>l(s=>({...s,rate:i.target.value})),min:"0",step:"0.1"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Отзывы"}),e.jsx("input",{type:"number",className:n.Admin__input,value:c.commentsSum,onChange:i=>l(s=>({...s,commentsSum:i.target.value})),min:"0"})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Ссылка на изображение"}),e.jsx("input",{className:n.Admin__input,value:c.imgUrl,onChange:i=>l(s=>({...s,imgUrl:i.target.value})),placeholder:"/images/goods/1/image.webp"})]}),e.jsxs("div",{className:n.Admin__uploadRow,children:[e.jsx("label",{className:n.Admin__label,children:"Или загрузите файл"}),e.jsx("input",{type:"file",accept:"image/*",className:n.Admin__fileInput,onChange:i=>O(i.target.files?i.target.files[0]:null,"goods")}),F?e.jsx("p",{className:`${n.Admin__uploadFeedback} ${n[`Admin__uploadFeedback--${F.state}`]}`,children:F.message}):null]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Описание"}),e.jsx("textarea",{className:n.Admin__textarea,value:c.description,onChange:i=>l(s=>({...s,description:i.target.value})),rows:3,placeholder:"Описание товара, которое появится в модальном окне"})]})]}),e.jsx("div",{className:n.Admin__switchRow,children:e.jsxs("label",{className:n.Admin__label,children:[e.jsx("input",{type:"checkbox",checked:c.isHit,onChange:i=>l(s=>({...s,isHit:i.target.checked}))}),"Позвать ХИТ"]})}),e.jsxs("div",{className:n.Admin__actions,children:[e.jsx("button",{type:"button",className:n.Admin__secondaryButton,onClick:V,children:"Сбросить"}),e.jsx("button",{className:n.Admin__submitButton,type:"submit",children:m?"Сохранить товар":"Добавить товар"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:n.Admin__sectionTitle,children:"Статьи и публикации"}),e.jsxs("div",{className:n.Admin__panelGrid,children:[e.jsx("div",{className:n.Admin__listColumn,children:re()}),e.jsxs("form",{className:n.Admin__detailPanel,onSubmit:te,children:[e.jsxs("div",{className:n.Admin__formGrid,children:[e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Название статьи"}),e.jsx("input",{className:n.Admin__input,value:w.title,onChange:i=>A(s=>({...s,title:i.target.value})),required:!0})]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Ссылка на изображение"}),e.jsx("input",{className:n.Admin__input,value:w.imgUrl,onChange:i=>A(s=>({...s,imgUrl:i.target.value})),placeholder:"/images/articles/1/image.webp"})]}),e.jsxs("div",{className:n.Admin__uploadRow,children:[e.jsx("label",{className:n.Admin__label,children:"Или загрузите файл"}),e.jsx("input",{type:"file",accept:"image/*",className:n.Admin__fileInput,onChange:i=>O(i.target.files?i.target.files[0]:null,"articles")}),U?e.jsx("p",{className:`${n.Admin__uploadFeedback} ${n[`Admin__uploadFeedback--${U.state}`]}`,children:U.message}):null]}),e.jsxs("div",{className:n.Admin__fieldGroup,children:[e.jsx("label",{className:n.Admin__label,children:"Ссылка"}),e.jsx("input",{className:n.Admin__input,value:w.link,onChange:i=>A(s=>({...s,link:i.target.value})),placeholder:"/articles/new"})]})]}),e.jsxs("div",{className:n.Admin__actions,children:[e.jsx("button",{type:"button",className:n.Admin__secondaryButton,onClick:M,children:"Сбросить"}),e.jsx("button",{className:n.Admin__submitButton,type:"submit",children:r?"Сохранить статью":"Создать статью"})]})]})]})]})]})}),e.jsxs("aside",{className:n.Admin__sidebar,children:[e.jsxs("div",{className:n.Admin__sidebarBlock,children:[e.jsx("p",{className:n.Admin__sidebarLabel,children:"Изменяемый блок"}),e.jsx("label",{className:n.Admin__sidebarLabel,children:"Текст блока"}),e.jsx("textarea",{className:n.Admin__sidebarTextarea,value:ee,onChange:le}),e.jsx("label",{className:n.Admin__sidebarLabel,children:"Фон-изображение"}),e.jsx("input",{className:n.Admin__sidebarImageInput,type:"file",accept:"image/*",onChange:me}),x?e.jsx("div",{className:n.Admin__sidebarImagePreview,children:e.jsx("img",{src:x,alt:"Превью блока",className:n.Admin__sidebarImage})}):null]}),e.jsx("div",{className:n.Admin__sidebarDivider}),e.jsx("p",{className:n.Admin__sidebarTitle,children:"Действия"}),e.jsx("button",{type:"button",className:n.Admin__secondaryButton,onClick:I==="goods"?V:M,children:"+ Создать новую запись"}),e.jsx("div",{className:n.Admin__sidebarDivider}),e.jsxs("div",{className:n.Admin__metaBlock,children:[e.jsx("p",{className:n.Admin__metaLabel,children:"SEO-текст"}),e.jsxs("p",{className:n.Admin__metaValue,children:[((K=(z=p.data)==null?void 0:z.text)==null?void 0:K.slice(0,120))||"Описание пока не загружено","…"]})]})]})]}):e.jsx("section",{className:n.Admin__loginPanel,children:e.jsxs("div",{className:n.Admin__loginCard,children:[e.jsx("p",{className:n.Admin__eyebrow,children:"Административный доступ"}),e.jsx("h1",{className:n.Admin__loginTitle,children:"Введите секретный код"}),e.jsx("p",{className:n.Admin__loginDescription,children:"После подтверждения вы получите доступ к рабочим карточкам управления товарным каталогом и блогом."}),e.jsxs("form",{className:n.Admin__loginForm,onSubmit:se,children:[e.jsx("label",{className:n.Admin__label,htmlFor:"admin-code",children:"Секретный код"}),e.jsx("input",{id:"admin-code",className:n.Admin__input,type:"password",value:G,onChange:i=>D(i.target.value),placeholder:"Введите код доступа"}),e.jsx("button",{className:n.Admin__submitButton,type:"submit",children:"Подтвердить"}),P?e.jsx("p",{className:n.Admin__status,children:P}):null]})]})})})})});export{Gn as default};
