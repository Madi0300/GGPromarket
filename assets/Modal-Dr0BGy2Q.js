import{w as I,z as w,a as r,x as C,y as W,p as _}from"./chunk-UH6JLGW7-C5_N2qaM.js";import{d as G,b as R}from"./apiSlise-DkzWnf8z.js";import{u as U,a as k}from"./hooks-c0Jm5PRv.js";import{R as E}from"./ui-C_hnAzDc.js";import{t as H}from"./clientStates-Ijc_ZD4W.js";const P="_Modal_1p0iv_1",T="_Modal__content_1p0iv_30",$="_Modal__imgWrapper_1p0iv_34",F="_Modal__img_1p0iv_34",A="_Modal__contentWrapper_1p0iv_55",O="_Modal__title_1p0iv_74",Q="_Modal__category_1p0iv_89",Y="_Modal__info_1p0iv_98",z="_Modal__info__price_1p0iv_102",B="_Modal__info__discount_1p0iv_111",L="_Modal__info__country_1p0iv_121",q="_Modal__description_1p0iv_130",J="_Modal__signs_1p0iv_141",K="_Modal__isHit_1p0iv_147",V="_Modal__isDiscount_1p0iv_156",X="_Modal__close_1p0iv_166",Z="_Modal__forms_1p0iv_197",__="_Modal__form__button_1p0iv_219",o_="_Modal__form__button__add_1p0iv_236",a_="_Modal__form__button__buy_1p0iv_245",s_="_Modal__wrapper_1p0iv_254",a={Modal:P,Modal__content:T,Modal__imgWrapper:$,Modal__img:F,Modal__contentWrapper:A,Modal__title:O,Modal__category:Q,Modal__info:Y,Modal__info__price:z,Modal__info__discount:B,Modal__info__country:L,Modal__description:q,Modal__signs:J,Modal__isHit:K,Modal__isDiscount:V,Modal__close:X,Modal__forms:Z,Modal__form__button:__,Modal__form__button__add:o_,Modal__form__button__buy:a_,Modal__wrapper:s_},p_=I(function(){const p=w(),{productId:t}=p,i=Number(t),u=typeof t=="string",[M,c]=r.useState(!1),{data:m,isSuccess:f}=G(null),d=f?m.serverUrl:"",v="/GGPromarket/Goods/default.webp",{data:o,isSuccess:g,isError:l_,error:n_}=R(`${t}`),h=U(s=>s.clientState.cartItems).includes(i),x=k(),j=C(),n=W(),e=n.state??{};function b(){const l=n.pathname.startsWith("/catalog")?`/catalog${n.search}`:"/",S=e.returnTo??l,D=e.scrollY!=null?{scrollTo:e.scrollY}:void 0;j(S,{preventScrollReset:!0,replace:!0,state:D})}async function N(s){if(s.preventDefault(),!d||!o)return;const l=new FormData;l.append("id",o.id.toString()),await fetch(`${d}/api/purchase`,{method:"POST",body:l})}function y(s){s.preventDefault(),x(H(i))}return r.useEffect(()=>{c(!1)},[t]),_.jsx(_.Fragment,{children:u?_.jsx("div",{className:a.Modal__wrapper,children:_.jsxs("div",{className:a.Modal,children:[_.jsxs("div",{className:a.Modal__close,onClick:b,children:[_.jsx("span",{className:a.Modal__close__span}),_.jsx("span",{className:a.Modal__close__span})]}),g?_.jsxs(_.Fragment,{children:[_.jsxs("div",{className:a.Modal__imgWrapper,children:[_.jsx("img",{src:M?v:o.imgUrl,alt:o.name,className:a.Modal__img,onError:()=>{c(!0)}}),_.jsxs("div",{className:a.Modal__signs,children:[o.isHit?_.jsx("div",{className:a.Modal__isHit,children:"ХИТ"}):null,o.discount!=null&&o.discount<o.price?_.jsx("div",{className:a.Modal__isDiscount,children:"АКЦИЯ"}):null]})]}),_.jsxs("div",{className:a.Modal__contentWrapper,children:[_.jsxs("div",{className:a.Modal__content,children:[_.jsx("h3",{className:a.Modal__title,children:o.name}),_.jsx(E,{rateSum:o.rate,commentsSum:o.commentsSum}),_.jsx("div",{className:a.Modal__category,children:o.category}),_.jsxs("div",{className:a.Modal__info,children:[_.jsx("div",{className:a.Modal__info__price,children:o.discount!=null&&o.discount<o.price?o.discount+" ₽":o.price+" ₽"}),o.discount!=null&&o.discount<o.price?_.jsx("div",{className:a.Modal__info__discount,children:o.discount<o.price?o.price+" ₽":o.discount+" ₽"}):null,_.jsx("div",{className:a.Modal__info__country,children:o.country})]}),_.jsx("p",{className:a.Modal__description,children:o.description})]}),_.jsxs("div",{className:a.Modal__forms,children:[_.jsx("button",{onClick:N,className:a.Modal__form__button+" "+a.Modal__form__button__buy,children:"Купить сейчас"}),_.jsx("button",{onClick:y,className:a.Modal__form__button+" "+a.Modal__form__button__add,children:h?"В корзине":"В корзину"})]})]})]}):null]},t)}):null})});export{p_ as default};
