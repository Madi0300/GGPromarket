import{w as te,A as se,a as o,y as ne,p as e,O as ae}from"./chunk-UH6JLGW7-C5_N2qaM.js";import{a as ce}from"./ui-C_hnAzDc.js";import{G as oe}from"./GoodsCard-L9R2VJc0.js";import{e as ie,f as re}from"./apiSlise-DkzWnf8z.js";import{a as le}from"./catalogCategories-Bq9D1Apy.js";import"./hooks-c0Jm5PRv.js";import"./clientStates-Ijc_ZD4W.js";const ue="_catalogPage_1f9h4_1",de="_catalogHeader_1f9h4_9",he="_catalogEyebrow_1f9h4_17",me="_catalogTitle_1f9h4_25",pe="_catalogStats_1f9h4_32",ge="_catalogLayout_1f9h4_37",fe="_filtersPanel_1f9h4_43",xe="_filtersPanelVisible_1f9h4_58",_e="_filtersToggleWrapper_1f9h4_62",be="_filtersToggleButton_1f9h4_67",je="_searchForm_1f9h4_77",Pe="_searchControl_1f9h4_87",ve="_priceForm_1f9h4_113",ye="_priceFormLabel_1f9h4_118",Ne="_sectionHeader_1f9h4_126",we="_priceInputs_1f9h4_133",Se="_priceDivider_1f9h4_147",Ce="_applyButton_1f9h4_151",ke="_section_1f9h4_126",Be="_categoriesList_1f9h4_168",Le="_checkboxLabel_1f9h4_177",Fe="_resetButton_1f9h4_192",Te="_resultsPanel_1f9h4_202",Ee="_stateBanner_1f9h4_209",Ge="_cardsGrid_1f9h4_217",Ie="_pagination_1f9h4_224",Re="_paginationActive_1f9h4_245",He="_paginationDots_1f9h4_251",s={catalogPage:ue,catalogHeader:de,catalogEyebrow:he,catalogTitle:me,catalogStats:pe,catalogLayout:ge,filtersPanel:fe,filtersPanelVisible:xe,filtersToggleWrapper:_e,filtersToggleButton:be,searchForm:je,searchControl:Pe,priceForm:ve,priceFormLabel:ye,sectionHeader:Ne,priceInputs:we,priceDivider:Se,applyButton:Ce,section:ke,categoriesList:Be,checkboxLabel:Le,resetButton:Fe,resultsPanel:Te,stateBanner:Ee,cardsGrid:Ge,pagination:Ie,paginationActive:Re,paginationDots:He},w=a=>{if(!a)return;const c=Number(a);return Number.isFinite(c)?c:void 0},Ae=a=>{const c=w(a.get("page")),u=w(a.get("limit")),_=w(a.get("minPrice")),h=w(a.get("maxPrice")),r=a.get("categories"),x=a.get("search")??"",l=r?r.split(",").map(N=>N.trim()).filter(Boolean):void 0,n=a.get("sale"),g=a.get("hit");return{page:c&&c>0?c:1,limit:u&&u>0?u:void 0,minPrice:_,maxPrice:h,categories:l,search:x,sale:n==="1"||n==="true",hit:g==="1"||g==="true"}},V=a=>{if(!a.trim())return;const c=Number(a.replace(/\s+/g,""));return Number.isFinite(c)?c:void 0};function Qe({}){return[{title:"Каталог товаров | GG Promarket"},{name:"description",content:"Фильтруйте каталог GG Promarket по цене, категориям и акциям."}]}const Ue=te(function(){const[c,u]=se(),[_,h]=o.useState(!1),[r,x]=o.useState(!1),l=ne(),n=o.useMemo(()=>Ae(c),[c]),[g,N]=o.useState(n.categories??[]),v=o.useRef(null),b=o.useRef(null),C=o.useMemo(()=>({...n,limit:n.limit??12}),[n]),{data:j,isFetching:k,isError:B,error:O}=ie(C),{data:f}=re(),[L,F]=o.useState(n.search??""),[T,E]=o.useState(n.minPrice!=null?String(n.minPrice):""),[G,I]=o.useState(n.maxPrice!=null?String(n.maxPrice):"");o.useEffect(()=>{F(n.search??"")},[n.search]),o.useEffect(()=>{E(n.minPrice!=null?String(n.minPrice):"")},[n.minPrice]),o.useEffect(()=>{I(n.maxPrice!=null?String(n.maxPrice):"")},[n.maxPrice]),o.useEffect(()=>{N(n.categories??[])},[n.categories]),o.useEffect(()=>{if(typeof window>"u")return;const t=()=>{x(window.innerWidth<=722)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[]),o.useEffect(()=>{r||h(!1)},[r]),o.useEffect(()=>()=>{b.current&&clearTimeout(b.current)},[]),o.useEffect(()=>{var i,d;if(typeof window>"u")return;if(v.current!=null){window.scrollTo({top:v.current,behavior:"auto"}),v.current=null;return}const t=((i=l.state)==null?void 0:i.scrollTo)??((d=l.state)==null?void 0:d.scrollY);if(typeof t=="number"){window.scrollTo({top:t,behavior:"auto"});const p={...l.state};delete p.scrollTo,delete p.scrollY,window.history.replaceState(p,"",window.location.pathname+window.location.search)}},[l.key,l.pathname,l.search,l.state]);const P=o.useCallback(t=>{const i=new URLSearchParams(c);Object.entries(t).forEach(([d,p])=>{p==null||p===""?i.delete(d):i.set(d,String(p))}),u(i)},[c,u]),W=o.useCallback(t=>{b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{typeof window<"u"&&(v.current=window.scrollY),P({categories:t.length>0?t.join(","):null,page:1}),b.current=null},2e3)},[P]),z=t=>{t.preventDefault(),P({search:L.trim(),page:1})},Y=t=>{t.preventDefault();let i=V(T),d=V(G);typeof i=="number"&&typeof d=="number"&&i>d&&([i,d]=[d,i]),typeof window<"u"&&(v.current=window.scrollY),P({minPrice:typeof i=="number"?i:null,maxPrice:typeof d=="number"?d:null,page:1})},$=t=>{const i=g,p=i.includes(t)?i.filter(ee=>ee!==t):[...i,t];N(p),W(p)},R=(t,i)=>{P({[t]:i?"1":null,page:1})},Q=()=>{u({})},U=t=>{t<=0||P({page:t})},q=!r||_,S=(j==null?void 0:j.items)??[],m=j==null?void 0:j.pagination,H=(m==null?void 0:m.totalPages)??1,A=(m==null?void 0:m.page)??n.page??1,y=(m==null?void 0:m.total)??S.length,D=(m==null?void 0:m.limit)??C.limit??12,M=y===0?0:(A-1)*D+1,J=y===0?0:Math.min(M+D-1,y),K=g,X=!!n.sale,Z=!!n.hit;return e.jsxs("div",{className:s.catalogPage,children:[e.jsxs(ce,{children:[e.jsxs("div",{className:s.catalogHeader,children:[e.jsxs("div",{children:[e.jsx("p",{className:s.catalogEyebrow,children:"GG Promarket"}),e.jsx("h1",{className:s.catalogTitle,children:"Каталог товаров"})]}),e.jsx("div",{className:s.catalogStats,children:y>0?e.jsxs("span",{children:["Показано ",M,"-",J," из ",y]}):e.jsx("span",{children:"Товары не найдены"})})]}),e.jsxs("div",{className:s.catalogLayout,children:[r?e.jsx("div",{className:s.filtersToggleWrapper,children:e.jsx("button",{type:"button",className:s.filtersToggleButton,onClick:()=>h(t=>!t),"aria-expanded":_,children:_?"Скрыть фильтры":"Фильтры"})}):null,q?e.jsxs("aside",{className:`${s.filtersPanel} ${_&&r?s.filtersPanelVisible:""}`,children:[e.jsxs("form",{className:s.searchForm,onSubmit:z,children:[e.jsx("label",{htmlFor:"catalog-search",children:"Поиск по каталогу"}),e.jsxs("div",{className:s.searchControl,children:[e.jsx("input",{id:"catalog-search",type:"text",placeholder:"Введите название товара",value:L,onChange:t=>F(t.target.value)}),e.jsx("button",{type:"submit",children:"Найти"})]})]}),e.jsxs("form",{className:s.priceForm,onSubmit:Y,children:[e.jsx("div",{className:s.sectionHeader,children:"Цена, ₽"}),e.jsx("span",{className:s.priceFormLabel,children:"от — до"}),e.jsxs("div",{className:s.priceInputs,children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9\\s]*",placeholder:`от ${(f==null?void 0:f.priceRange.min)??"0"}`,value:T,onChange:t=>E(t.target.value)}),e.jsx("span",{className:s.priceDivider,children:"—"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9\\s]*",placeholder:`до ${(f==null?void 0:f.priceRange.max)??"0"}`,value:G,onChange:t=>I(t.target.value)})]}),e.jsx("button",{type:"submit",className:s.applyButton,children:"Применить"})]}),e.jsxs("div",{className:s.section,children:[e.jsx("div",{className:s.sectionHeader,children:"Категории"}),e.jsx("div",{className:s.categoriesList,children:((f==null?void 0:f.categories)??[]).map(t=>e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:K.includes(t),onChange:()=>$(t)}),e.jsx("span",{children:le[t]??t})]},t))})]}),e.jsxs("div",{className:s.section,children:[e.jsx("div",{className:s.sectionHeader,children:"Спецпредложения"}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:X,onChange:t=>R("sale",t.target.checked)}),e.jsx("span",{children:"Показывать акции"})]}),e.jsxs("label",{className:s.checkboxLabel,children:[e.jsx("input",{type:"checkbox",checked:Z,onChange:t=>R("hit",t.target.checked)}),e.jsx("span",{children:"Хиты продаж"})]})]}),e.jsx("button",{type:"button",className:s.resetButton,onClick:Q,children:"Сбросить фильтры"})]}):null,e.jsxs("section",{className:s.resultsPanel,children:[k?e.jsx("div",{className:s.stateBanner,children:"Загружаем подборку…"}):null,B?e.jsxs("div",{className:s.stateBanner,children:["Не удалось загрузить каталог: ",JSON.stringify(O)]}):null,!k&&!B&&S.length===0?e.jsx("div",{className:s.stateBanner,children:"По выбранным фильтрам ничего не найдено."}):null,e.jsx("div",{className:s.cardsGrid,children:S.map(t=>e.jsx(oe,{item:t,productRoutePrefix:"/catalog",locationSearch:l.search},t.id))}),H>1?e.jsx(De,{current:A,total:H,onChange:U}):null]})]})]}),e.jsx(ae,{})]})});function De({current:a,total:c,onChange:u}){const h=(()=>{let x=Math.max(1,a-2),l=Math.min(c,x+5-1);l-x<4&&(x=Math.max(1,l-5+1));const n=[];for(let g=x;g<=l;g++)n.push(g);return n})();return e.jsxs("div",{className:s.pagination,children:[e.jsx("button",{type:"button",onClick:()=>u(a-1),disabled:a<=1,children:"Назад"}),h[0]>1?e.jsx("button",{type:"button",onClick:()=>u(1),children:"1"}):null,h[0]>2?e.jsx("span",{className:s.paginationDots,children:"…"}):null,h.map(r=>e.jsx("button",{type:"button",onClick:()=>u(r),className:r===a?s.paginationActive:void 0,children:r},r)),h[h.length-1]<c-1?e.jsx("span",{className:s.paginationDots,children:"…"}):null,h[h.length-1]<c?e.jsx("button",{type:"button",onClick:()=>u(c),children:c}):null,e.jsx("button",{type:"button",onClick:()=>u(a+1),disabled:a>=c,children:"Вперёд"})]})}export{Ue as default,Qe as meta};
